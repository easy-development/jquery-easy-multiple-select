var jQueryEMSelect={selectObject:{},selectOptionsList:{},selectedOptionsList:[],Init:function(e){if(e.hasClass("dispatched"))return;e.addClass("dispatched");this.selectObject=e;this.selectObject.data("em_select",this);this.switchToInteractiveMode()},switchToInteractiveMode:function(){this.Helper.Init(this);this.InteractiveSection.Init(this);this.DOMObserver.Init(this)},InteractiveSection:{containerObject:{},selectObject:{},informationListObject:{},containerClass:"jquery-em-interactive-container",selectClass:"jquery-em-interactive-select",informationListClass:"jquery-em-interactive-information-list",selectOptionDisplayKey:"jquery-em-select-placeholder",selectOptionDisplayText:"Please Select...",Controller:{},Init:function(e){this.Controller=e;this.Controller.selectObject.hide();this.SetContainer();this.SetSelectInteraction()},Reset:function(){this.containerObject.remove();this.SetContainer();this.SetSelectInteraction()},SetContainer:function(){this.Controller.selectObject.after(this._getContainerHTML());this.containerObject=this.Controller.selectObject.next();this.selectObject=this.containerObject.find("> ."+this.selectClass);this.informationListObject=this.containerObject.find("> ."+this.informationListClass);this.SetSelectRemove()},_getContainerHTML:function(){var e=this;var t="";t+='<div class="'+e.containerClass+'">';t+='<select class="'+this.selectClass+'">';t+='<option value="'+this.selectOptionDisplayKey+'">'+this.selectOptionDisplayText+"</option>";jQuery.each(e.Controller.selectOptionsList,function(n,r){t+='<option value="'+n+'" '+(jQuery.inArray(n,e.Controller.selectedOptionsList)!=-1?'disabled="disabled"':"")+">"+r+"</option>"});t+="</select>";t+='<ul class="'+e.informationListClass+'">';jQuery.each(e.Controller.selectedOptionsList,function(n,r){t+=e._getSelectLineItem(r,e.Controller.selectOptionsList[r])});t+="</ul>";t+="</div>";return t},SetSelectInteraction:function(){var e=this;this.selectObject.bind("change",function(){if(jQuery(this).val()==e.selectOptionDisplayKey)return;var t=jQuery(this).val(),n=e.selectObject.find('> option[value="'+t+'"]').html();e.Controller.selectObject.val(jQuery.merge(jQuery.isEmptyObject(e.Controller.selectObject.val())?[]:e.Controller.selectObject.val(),[t]));e.selectObject.find('> option[value="'+t+'"]').attr("disabled","disabled");e.selectObject.val(e.selectOptionDisplayKey);e.informationListObject.append(e._getSelectLineItem(t,n));e.informationListObject.find(" > *:last").hide().slideDown("slow");e.SetSelectRemove()})},SetSelectRemove:function(){var e=this;this.informationListObject.find("> li > span.remove").not(".binded").addClass("binded").bind("click touchstart",function(){var t=jQuery(this).parent("li").attr("data-option-key"),n=e.Controller.selectObject.val();jQuery.each(n,function(e,r){if(r==t)delete n[e]});e.Controller.selectObject.val(n);e.selectObject.find('> option[value="'+t+'"]').removeAttr("disabled");jQuery(this).parent("li").slideUp("slow",function(){jQuery(this).remove()})})},_getSelectLineItem:function(e,t){return'<li data-option-key="'+e+'"><span class="text">'+t+'</span><span class="remove">Remove</span><span class="clear"></span></li>'}},DOMObserver:{Observer:{},Controller:{},Init:function(e){var t=this;this.Controller=e;if(typeof MutationObserver=="function"){this.Observer=new MutationObserver(function(e){t._observed()});this.Observer.observe(t.Controller.selectObject[0],{childList:true})}},_observed:function(){var e=Object.keys(this.Controller.Helper.getCurrentSelectElements()).sort();var t=Object.keys(this.Controller.selectOptionsList).sort();if(!(JSON.stringify(e)===JSON.stringify(t))){this.Controller.Helper.setCurrentSelectElements();this.Controller.InteractiveSection.Reset()}}},Helper:{Controller:{},Init:function(e){this.Controller=e;this.setCurrentSelectElements()},setCurrentSelectElements:function(){var e=this;e.Controller.selectOptionsList=this.getCurrentSelectElements();e.Controller.selectedOptionsList=this.getCurrentSelectedElements()},getCurrentSelectElements:function(){var e=this,t={};this.Controller.selectObject.find("> option").each(function(){t[jQuery(this).attr("value")]=jQuery(this).html()});return t},getCurrentSelectedElements:function(){var e=this,t=[];this.Controller.selectObject.find("> option:selected").each(function(){t[t.length]=jQuery(this).attr("value")});return t}}};jQuery(document).ready(function(){jQuery(".component-em-select").em_select()});jQuery.fn.extend({em_select:function(){jQuery(this).each(function(){var e=jQuery.extend(true,{},jQueryEMSelect);e.Init(jQuery(this))});return jQuery(this)}})